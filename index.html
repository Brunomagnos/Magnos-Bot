<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <!-- Regra CSP mais segura -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self';">
    <title>MagnosBot - Assistente WhatsApp</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header class="app-header">
        <h1>MagnosBot ‚ú®</h1>
        <div id="app-version-info">v?</div> <!-- Vers√£o ser√° preenchida se necess√°rio -->
    </header>

    <main class="main-container">
        <!-- Coluna Esquerda: Controle e Conex√£o -->
        <aside class="left-column">
            <section class="panel panel-control">
                <h2>Controle e Status</h2>
                <div class="button-group">
                    <!-- Bot√£o Start/Stop (handler din√¢mico) -->
                    <button id="startButton" class="btn-start">üöÄ Iniciar Bot</button>
                    <!-- Bot√£o Pause/Continuar (controlado por JS) -->
                    <button id="pauseButton" class="btn-pause" style="display: none;" title="Pausar/Continuar o recebimento">‚è∏Ô∏è Pausar</button>
                </div>
                <div id="status-area">
                    Status: <span id="status" class="status status-disconnected">Desconectado</span>
                </div>
                 <div class="secondary-actions">
                    <button id="checkUpdateButton" class="btn-secondary btn-small" title="Verificar novas vers√µes">üîÑ Verificar Updates</button>
                    <button id="clearSessionButton" class="btn-danger btn-small" title="Limpa sess√£o (exige novo QR)">üßπ Limpar Sess√£o</button>
                 </div>
                <!-- √Årea de Progresso do Update -->
                <div id="updateProgressContainer" style="display: none;">
                    <span id="updateProgressLabel"></span>
                    <progress id="updateProgressBar" value="0" max="100"></progress>
                </div>
            </section>

            <section class="panel panel-connection">
                 <h2>Conex√£o WhatsApp</h2>
                 <!-- √Årea QR -->
                 <div id="qr-code-container" class="connection-status-display">
                    <img id="qr-code-image" src="" alt="QR Code WhatsApp">
                    <span id="qr-placeholder">Aguardando iniciar...</span>
                 </div>
                 <!-- √Årea Conectado -->
                 <div id="connected-info-panel" class="connection-status-display" style="display: none;">
                    <div class="icon success-icon">‚úî</div>
                    <p>Conectado!</p>
                    <small>Monitorando mensagens...</small>
                 </div>
                  <!-- √Årea Erro -->
                  <div id="error-info-panel" class="connection-status-display" style="display: none;">
                    <div class="icon error-icon">‚ùå</div>
                    <p>Erro / Desconectado</p>
                    <small id="error-details">Verifique os logs.</small>
                 </div>
            </section>
        </aside>

        <!-- Coluna Direita: Regras e Logs -->
        <section class="right-column">
            <section class="panel panel-rules">
                 <h2>Gerenciador de Regras</h2>
                 <div class="rules-list-container scrollable">
                     <ul class="rules-list" id="rulesList">
                        <!-- Placeholder inicial -->
                        <li class="rule-item-placeholder">Carregando regras...</li>
                     </ul>
                 </div>
                 <!-- Bot√£o para abrir formul√°rio -->
                 <button id="addNewRuleButton" class="btn-add">‚ûï Adicionar Nova Regra</button>

                 <!-- Formul√°rio de Edi√ß√£o/Adi√ß√£o (escondido por padr√£o) -->
                 <div class="edit-rule-form" id="editRuleForm" style="display: none;">
                     <h3 id="formRuleTitle">Adicionar Nova Regra</h3>
                     <input type="hidden" id="formRuleIndex" value="-1"> <!-- √çndice da regra (-1 = nova) -->

                     <div class="form-group">
                        <label for="formRuleTriggers">Gatilhos (palavras separadas por v√≠rgula):</label>
                        <input type="text" id="formRuleTriggers" placeholder="ex: ol√°, bom dia, or√ßamento">
                        <small>Se a msg contiver alguma destas palavras.</small>
                     </div>

                     <div class="form-group">
                        <label for="formRuleResponse">Resposta Autom√°tica:</label>
                        <textarea id="formRuleResponse" placeholder="ex: Ol√°! Bem-vindo(a)! Como posso ajudar?" rows="3"></textarea>
                        <small>Mensagem que o bot enviar√°.</small>
                     </div>

                     <div class="form-check">
                         <input type="checkbox" id="formRuleIsLead" class="form-check-input">
                         <label for="formRuleIsLead" class="form-check-label">Qualificar como Lead e Encaminhar?</label>
                     </div>

                     <!-- Op√ß√µes de Encaminhamento (mostradas via JS) -->
                     <div id="formForwardingOptions" class="form-forwarding-options" style="display: none;">
                         <div class="form-group">
                             <label for="formRuleForwardTo">Encaminhar para este WhatsApp:</label>
                             <input type="text" id="formRuleForwardTo" placeholder="55119XXXXXXXX@c.us">
                             <small>Formato completo: [cod pa√≠s][cod area][numero]@c.us</small>
                         </div>
                         <div class="form-group">
                             <label for="formRuleForwardPrefix">Prefixo p/ Msg Encaminhada (opcional):</label>
                             <input type="text" id="formRuleForwardPrefix" placeholder="Ex: [Lead Site]">
                             <small>Ser√° adicionado ANTES da mensagem original.</small>
                         </div>
                     </div>

                     <div class="form-actions">
                         <span id="formRuleStatus" class="form-status"></span>
                         <button type="button" id="cancelRuleEditButton" class="btn-secondary">Cancelar</button>
                         <button type="button" id="saveRuleFormButton" class="btn-primary">Salvar Regra</button>
                     </div>
                 </div>
            </section>

            <section class="panel panel-logs">
                 <h2>Console de Logs</h2>
                 <div id="logs" class="log-output scrollable">
                     <!-- Logs ser√£o adicionados dinamicamente -->
                     <div class="log-entry log-info"><span class="timestamp">[...]</span><span class="message">Interface carregada.</span></div>
                 </div>
            </section>
        </section>
    </main>

    <!-- Script principal do Renderer -->
    <script src="./renderer.js"></script>
</body>
</html>